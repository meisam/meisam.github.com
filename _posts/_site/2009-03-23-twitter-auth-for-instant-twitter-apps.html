<div style='float: right; margin-left: 10px; margin-bottom: 10px'><img src='http://img.skitch.com/20090320-x339jfeehaeftua1sysax3wsrj.jpg' alt='TwitterAuth'/></div>
<p>The public beta of Twitter OAuth support <a href="http://news.cnet.com/8301-17939_109-10197898-2.html?part=rss&amp;tag=feed&amp;subj=Webware">has been released</a> and I&#8217;m excited to introduce a new library that I&#8217;ve been working on called <strong>TwitterAuth</strong>. TwitterAuth is a Rails plugin that provides a full external authentication stack for Rails applications utilizing Twitter. Think of it as &#8220;Twitter Connect&#8221; for Rails, letting you create an application that may be logged into using only Twitter credentials.</p>
<p>TwitterAuth supports both <strong>OAuth</strong> and <strong><span class="caps">HTTP</span> Basic</strong> (though OAuth is certainly the recommended strategy) giving you maximum flexibility for building the application. Without further ado, let&#8217;s get into the installation and usage of TwitterAuth!</p>
<h3>Installation</h3>
<p>TwitterAuth is available as a GemPlugin, so the preferred way to install it is simply to add it as a dependency in your <code>config/environment.rb</code>:</p>
<pre name='code' class='ruby'>config.gem 'twitter-auth', :lib =&gt; 'twitter_auth'</pre>
<p>You can also choose to install it as a traditional Rails plugin:</p>
<pre name='code'>script/plugin install git://github.com/mbleigh/twitter-auth.git</pre>
<p>Once you&#8217;ve installed it, you&#8217;re ready to create a new application using TwitterAuth!</p>
<h3>The Low-Down</h3>
<p>TwitterAuth uses Rails 2.3 Engine support to completely encapsulate the login process within itself. All you need to do is run a generator to make all of the support files necessary in your application. Run it with the <code>--basic</code> option if you want to use <span class="caps">HTTP</span> Basic, otherwise it will default to OAuth.</p>
<pre>script/generate twitter_auth</pre>
<p>This generates a User class, a migration, and <code>twitter_auth.yml</code>. You will need to edit <code>twitter_auth.yml</code> to match the settings of your application, such as providing the OAuth client token and secret.</p>
<p>Once you&#8217;ve migrated, that&#8217;s it! You are up and running with Twitter authentication; just point users at <code>/login</code> to start the process (login and registration are handled in a single step). For more detailed usage information including how to access the Twitter <span class="caps">API</span> through TwitterAuth, take a look at <a href="http://github.com/mbleigh/twitter-auth">the <span class="caps">README</span> file</a>.</p>
<p>The source for TwitterAuth is <a href="http://github.com/mbleigh/twitter-auth">available on GitHub</a>. I have also created a <a href="http://mbleigh.lighthouseapp.com/projects/27783-twitterauth">Lighthouse Project</a> for the reporting of any bugs you may come across. There is also a <a href="http://mbleigh.com/twitter-auth/">basic homepage</a> that will be listing who&#8217;s using TwitterAuth.</p>
<p>If you&#8217;re pretty familiar with Rails authentication systems (particularly <a href="http://github.com/technoweenie/restful-authentication">Restful Authentication</a>), this is probably all you need to know to get started. Go forth and make awesome apps! If not, I&#8217;ve written a quick run-through of the whole process to make it easy for <strong>anyone</strong> to get started with Twitter apps.</p>
<h3>A Quick Run-Through</h3>
<p>I think the best way to show what TwitterAuth is capable of is just to show how quickly you can build a simple Twitter application with it. To that end, let&#8217;s build a simple way to look at your friends&#8217; timeline in an old-school text-based way (note, this is a totally useless application but works well for a quick demo). First we need to generate the app:</p>
<pre>rails texty-twitter</pre>
<p>Next we want to install TwitterAuth on the application, so we&#8217;ll add this to our <code>config/environment.rb</code>:</p>
<pre name='code' class='ruby'>config.gem 'twitter-auth', :lib =&gt; 'twitter_auth'</pre>
<p>Once we have hooked TwitterAuth into the application, we will want to run the generator to build the support files we need:</p>
<pre>script/generate twitter_auth --oauth</pre>
<p>Before I start on application logic I always lay out a basic <span class="caps">HTML</span> layout. Here it is for this application (in <code>app/views/layouts/master.html.erb</code>):</p>
<pre name='code' class='html'>&lt;html&gt;
  &lt;head&gt;
    &lt;style type='text/css'&gt;
      ul.tweets {
        list-style: none;
        margin: 0;
        padding: 0;
      }

      ul.tweets li {
        font-family: monospace;
        font-size: 14px;
        padding: 4px 8px;
      }

      ul.tweets li a {
        color: #fa0;
        font-weight: bold;
        text-decoration: none;
      }
    &lt;/style&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;%= yield %&gt;
  &lt;/body&gt;
&lt;/html&gt;</pre>
<p>The next step is to edit <code>config/twitter_auth.yml</code> to reflect our OAuth client key and secret (to register your application log in to Twitter and visit <a href="http://twitter.com/oauth_clients">http://twitter.com/oauth_clients</a>). Other than the client key and secret, the defaults are fine for our purposes. We&#8217;ve now set up a basic TwitterAuth application; that&#8217;s really all there is to it. So now let&#8217;s make it a <strong>working</strong> Twitter application. First let&#8217;s generate a controller:</p>
<pre>script/generate controller timeline</pre>
<p>This will just be a one-action controller that will render out the main timeline for the logged in user in an text-based manner. Here&#8217;s the contents of the controller:</p>
<pre name='code' class='ruby'>class TimelineController &lt; ApplicationController
  # this requires us to log in through Twitter before accessing any actions here
  before_filter :login_required

  def index  
    @tweets = current_user.twitter.get('/statuses/friends_timeline')
  end
end</pre>
<p>In this action, <code>current_user</code> is the logged in user, and the <code>twitter</code> method provides a simple wrapper around the <a href="http://apiwiki.twitter.com/REST+API+Documentation">Twitter <span class="caps">REST</span> <span class="caps">API</span></a> that will automatically parse <span class="caps">JSON</span> <span class="caps">API</span> requests into Ruby hashes for you to use in your application. So <code>current_user.twitter.get('/statuses/friends_timeline')</code> will grab the latest statuses from your friends&#8217; timeline (the main timeline you see when you&#8217;re logged in to Twitter) as an array of hashes. Now let&#8217;s display the tweets by creating <code>app/views/timeline/index.html.erb</code>:</p>
<pre name='code' class='html'>&lt;ul class='tweets'&gt;
  &lt;% for tweet in @tweets %&gt;
    &lt;li&gt;&lt;%= link_to tweet['user']['screen_name'] + ':', 'http://twitter.com/' + tweet['user']['screen_name'], :target =&gt; '_blank' %&gt; &lt;%= tweet['text'] %&gt;&lt;/li&gt;
  &lt;% end %&gt;
&lt;/ul&gt;</pre>
<p>This simply goes through each of the tweets we pulled down and adds a list item with a link to the author of the tweet and the content of the tweet. The structure of the hashes are identical to their description in the <a href="http://apiwiki.twitter.com/REST+API+Documentation#ReturnElements">Return Elements section of the Twitter <span class="caps">API</span> wiki</a>.</p>
<p>Finally, we need to add some routing to tie everything together. Make the <code>config/routes.rb</code> look like this:</p>
<pre name='code' class='ruby'>ActionController::Routing::Routes.draw do |map|
  map.root :controller =&gt; 'stream', :action =&gt; 'index'
end</pre>
<p>And we&#8217;re done! Fire up your server with <code>script/server</code> and go to <code>http://localhost:3000/</code>. If everything is working properly, it should redirect you to Twitter with a screen like this:</p>
<p style="text-align: center;"><img src="http://img.skitch.com/20090320-qwxf5rnn4qs75a7xbwccsppgam.jpg" alt="" /></p>
<p>Once you click through and hit allow, it should then take you back and display your tweet stream in an old-school text interface, something like this:</p>
<p style="text-align: center;"><img src="http://img.skitch.com/20090321-nefkuh6xdq3jx8wejg8a11hsew.jpg" alt="" /></p>
<p>It&#8217;s a simple and useless application, but in about 10-15 minutes you&#8217;ve created a fully-functioning Rails application that accesses the Twitter <span class="caps">API</span> and stores user information. Not bad!</p>
<h3>See You At RailsConf!</h3>
<p><a href='http://en.oreilly.com/rails2009/public/schedule/detail/8517' target='_blank'><img src="http://assets.en.oreilly.com/1/event/24/rails2009_banner_speaking_210x60.jpg" width="210" height="60"  border="0"  alt="RailsConf 2009" title="RailsConf 2009" /></a></p>
<p>TwitterAuth is a big part of what I will be talking about at RailsConf in my session <a href="http://en.oreilly.com/rails2009/public/schedule/detail/8517">&#8216;Twitter on Rails&#8217;</a>. if you&#8217;re interested in the plugin and attending RailsConf in May I hope you&#8217;ll stop by; I&#8217;ll be building an entire Twitter application from scratch during the 45 minute presentation. Also, feel free to <a href="http://twitter.com/mbleigh">follow me on Twitter</a> if you&#8217;re so inclined.</p>